pwd
getwd()
setwd("~/Documents/OneDrive - Johns Hopkins/Shubhayu_Projects/Johns Hopkins University/ICU Motion Study/bims/scripts")
list.files()
library(parallel)
detectCores()
library(devtools)
if (!require(lolR))
install_github('neurodata/lol',
build_vignettes = TRUE,
force = TRUE)
library(lolR)
library(R.matlab)
library(tidyverse)
library(ggplot2)
library(plotly)
library(naniar)
library(MASS)
library(glmnet)
library(caret)
library(kernlab)
library(rlist)
library(cvAUC)
library(gridExtra)
library(ggplotify)
library(grid)
library(cowplot)
library(nnet)
library(parallel)
library(fastAdaboost)
library(cutpointr)
library(precrec)
if(.Platform$OS.type == "unix") {
library(doMC)
} else {
library(doParallel)
}
source('./functions/load_patient_clinical_data.R')
patient_clinical_data <- load_patient_clinical_data()
patient_clinical_data <- load_patient_clinical_data('../clinical_data/patient_clinical_data.csv')
sum)patient_clinical_data$DiedDuringThisHospitalStay_)
sum(patient_clinical_data$DiedDuringThisHospitalStay_)
sum(as.numeric(patient_clinical_data$DiedDuringThisHospitalStay_))
sum(as.numeric(patient_clinical_data$DiedDuringThisHospitalStay_)-1)
View(patient_clinical_data)
View(patient_clinical_data)
69-sum(as.numeric(patient_clinical_data$DiedDuringThisHospitalStay_)-1)
schmoopy<-read.csv('../clinical_data/12mo_outcomes.xlsx')
View(schmoopy)
library(readxl)
schmoopy<-read_xlsx('../clinical_data/12mo_outcomes.xlsx')
View(schmoopy)
View(schmoopy)
sum(as.numeric(patient_clinical_data$DiedDuringThisHospitalStay_)-1)-sum(as.numeric(patient_clinical_data$Death12Months)-1)
sum(as.numeric(patient_clinical_data$Death12Months)-1)
patient_clinical_data$Death12Months
sum(patient_clinical_data$Death12Months)
as.numeric(patient_clinical_data$Death12Months)
sum(as.numeric(patient_clinical_data$Death12Months))
sum(as.numeric(patient_clinical_data$Death12Months),na.rm = TRUE)
sum(as.numeric(patient_clinical_data$Death12Months)-1,na.rm = TRUE)
sum(as.numeric(patient_clinical_data$Death12Months)-1,na.rm = TRUE)
28-16
is.na(patient_clinical_data$GOS_E12Months)
sum(is.na(patient_clinical_data$GOS_E12Months))
is.na(patient_clinical_data$Death12Months)
sum(is.na(patient_clinical_data$Death12Months))
source('./functions/load_patient_clinical_data.R')
source('./functions/update_clinicalVariableList.R')
source('./functions/get_motion_features.R')
source('./functions/lol_project_motion_features.R')
source("./functions/load_tf_patient_covariates.R")
source('./functions/cv_lol_project_motion_features.R')
source('./functions/prepare_training_covariates.R')
source('./functions/prepare_testing_covariates.R')
source('./functions/train_caret_models.R')
source('./functions/predict_caret_models.R')
source('./functions/classification_function.R')
source('./functions/get_sens_info.R')
source('./functions/get_spec_info.R')
source('./functions/get_PPV_info.R')
source('./functions/get_NPV_info.R')
source('./functions/get_acc_info.R')
source('./functions/get_auc_info.R')
source('./functions/get_precrec_info.R')
source('./functions/get_auc_cp.R')
source('./functions/get_auc_plots.R')
source('./functions/get_precrec_plots.R')
source('./functions/get_auc_info_ci.R')
source('./functions/generateRootDir.R')
source('./functions/get_cutpoint.R')
source('./functions/plot_metric_stripcharts.R')
source('./functions/fix_test_cutpoint.R')
# Set the number of parallel cores for parallel tuning
no.parallel.cores <- floor(2 * detectCores() / 3)
if(.Platform$OS.type == "unix") {
registerDoMC(cores = no.parallel.cores)
} else {
registerDoParallel(cores = no.parallel.cores)
}
# Load Motion Features Organized by Time of Day (TOD)
if (!exists("tod_motion_features")) {
tod_sensors <-
readMat('../tod_motion_feature_data/bed_corrected_imputed_complete_sensor_data.mat')$bed.corrected.sensors
tod_motion_features <- get_motion_features(do.call(rbind, tod_sensors))
}
# Load Motion Features Organized by Time from Recording (TFR)
if (!exists("tfr_motion_features")) {
tfr_sensors <-
readMat('../tfr_motion_feature_data/bed_corrected_imputed_complete_sensor_data.mat')$bed.corrected.sensors
tfr_motion_features <- get_motion_features(do.call(rbind, tfr_sensors))
}
version
881*2
1700 + 800
2500+800
library(devtools)
if (!require(lolR))
install_github('neurodata/lol',
build_vignettes = TRUE,
force = TRUE)
library(lolR)
library(R.matlab)
library(tidyverse)
library(ggplot2)
library(plotly)
library(naniar)
library(MASS)
library(glmnet)
library(caret)
library(kernlab)
library(rlist)
library(cvAUC)
library(gridExtra)
library(ggplotify)
library(grid)
library(cowplot)
library(nnet)
library(parallel)
library(fastAdaboost)
library(cutpointr)
library(precrec)
if(.Platform$OS.type == "unix") {
library(doMC)
} else {
library(doParallel)
}
source('./functions/load_patient_clinical_data.R')
source('./functions/update_clinicalVariableList.R')
source('./functions/get_motion_features.R')
source('./functions/lol_project_motion_features.R')
source("./functions/load_tf_patient_covariates.R")
source('./functions/cv_lol_project_motion_features.R')
source('./functions/prepare_training_covariates.R')
source('./functions/prepare_testing_covariates.R')
source('./functions/train_caret_models.R')
source('./functions/predict_caret_models.R')
source('./functions/classification_function.R')
source('./functions/get_sens_info.R')
source('./functions/get_spec_info.R')
source('./functions/get_PPV_info.R')
source('./functions/get_NPV_info.R')
source('./functions/get_acc_info.R')
source('./functions/get_auc_info.R')
source('./functions/get_precrec_info.R')
source('./functions/get_auc_cp.R')
source('./functions/get_auc_plots.R')
source('./functions/get_precrec_plots.R')
source('./functions/get_auc_info_ci.R')
source('./functions/generateRootDir.R')
source('./functions/get_cutpoint.R')
source('./functions/plot_metric_stripcharts.R')
source('./functions/fix_test_cutpoint.R')
# Set the number of parallel cores for parallel tuning
no.parallel.cores <- floor(2 * detectCores() / 3)
if(.Platform$OS.type == "unix") {
registerDoMC(cores = no.parallel.cores)
} else {
registerDoParallel(cores = no.parallel.cores)
}
# Load Motion Features Organized by Time of Day (TOD)
if (!exists("tod_motion_features")) {
tod_sensors <-
readMat('../tod_motion_feature_data/bed_corrected_imputed_complete_sensor_data.mat')$bed.corrected.sensors
tod_motion_features <- get_motion_features(do.call(rbind, tod_sensors))
}
# Load Motion Features Organized by Time from Recording (TFR)
if (!exists("tfr_motion_features")) {
tfr_sensors <-
readMat('../tfr_motion_feature_data/bed_corrected_imputed_complete_sensor_data.mat')$bed.corrected.sensors
tfr_motion_features <- get_motion_features(do.call(rbind, tfr_sensors))
}
View(patient_clinical_data)
mean(patient_clinical_data$DaysInNCCU)
mean(patient_clinical_data$DaysInHospital)
??prop.table
library(devtools)
if (!require(lolR))
install_github('neurodata/lol',
build_vignettes = TRUE,
force = TRUE)
library(lolR)
library(R.matlab)
library(tidyverse)
library(ggplot2)
library(plotly)
library(naniar)
library(MASS)
library(glmnet)
library(caret)
library(kernlab)
library(rlist)
library(cvAUC)
library(gridExtra)
library(ggplotify)
library(grid)
library(cowplot)
library(nnet)
library(parallel)
library(fastAdaboost)
library(cutpointr)
library(precrec)
if(.Platform$OS.type == "unix") {
library(doMC)
} else {
library(doParallel)
}
source('./functions/load_patient_clinical_data.R')
source('./functions/update_clinicalVariableList.R')
source('./functions/get_motion_features.R')
source('./functions/lol_project_motion_features.R')
source("./functions/load_tf_patient_covariates.R")
source('./functions/cv_lol_project_motion_features.R')
source('./functions/prepare_training_covariates.R')
source('./functions/prepare_testing_covariates.R')
source('./functions/train_caret_models.R')
source('./functions/predict_caret_models.R')
source('./functions/classification_function.R')
source('./functions/get_sens_info.R')
source('./functions/get_spec_info.R')
source('./functions/get_PPV_info.R')
source('./functions/get_NPV_info.R')
source('./functions/get_acc_info.R')
source('./functions/get_auc_info.R')
source('./functions/get_precrec_info.R')
source('./functions/get_auc_cp.R')
source('./functions/get_auc_plots.R')
source('./functions/get_precrec_plots.R')
source('./functions/get_auc_info_ci.R')
source('./functions/generateRootDir.R')
source('./functions/get_cutpoint.R')
source('./functions/plot_metric_stripcharts.R')
source('./functions/fix_test_cutpoint.R')
# Set the number of parallel cores for parallel tuning
no.parallel.cores <- floor(2 * detectCores() / 3)
if(.Platform$OS.type == "unix") {
registerDoMC(cores = no.parallel.cores)
} else {
registerDoParallel(cores = no.parallel.cores)
}
# Load Motion Features Organized by Time of Day (TOD)
if (!exists("tod_motion_features")) {
tod_sensors <-
readMat('../tod_motion_feature_data/bed_corrected_imputed_complete_sensor_data.mat')$bed.corrected.sensors
tod_motion_features <- get_motion_features(do.call(rbind, tod_sensors))
}
# Load Motion Features Organized by Time from Recording (TFR)
if (!exists("tfr_motion_features")) {
tfr_sensors <-
readMat('../tfr_motion_feature_data/bed_corrected_imputed_complete_sensor_data.mat')$bed.corrected.sensors
tfr_motion_features <- get_motion_features(do.call(rbind, tfr_sensors))
}
View(tfr_motion_features)
View(tod_motion_features)
77754
77754/7
77754/6
77754/6/8
12959/8
8*60*60*10
8*60*12
18*60*12
12959
60*12
60*12-1
719*8
719*18
View(patient_clinical_data)
View(patient_clinical_data)
orgType = 'tfr'
motion_features=tfr_motion_features
length(motion_features)
loli<-readxl::read_
library(readxl)
loli<-read_xlsx('../accel_sensor_data/accel_time_info.xlsx')
View(loli)
lolipoop<-loli[apply(df[, endsWith(colnames(df), "_start")], 1, function(x) any(x == "TRUE")), ]
lolipoop<-loli[apply(df[, endsWith(colnames(loli), "_start")], 1, function(x) any(x == "TRUE")), ]
lolipoop <- loli %>% dplyr::select(ends_with("start"))
View(lolipoop)
library(readxl)
sensor_time_info <- read_xlsx('../accel_sensor_data/accel_time_info.xlsx')
View(sensor_time_info)
sensor_time_info <- read_xlsx('../accel_sensor_data/accel_time_info.xlsx') %>% select(3:24)
3:24
sensor_time_info <- read_xlsx('../accel_sensor_data/accel_time_info.xlsx') %>% select(c(3:24))
sensor_time_info <- read_xlsx('../accel_sensor_data/accel_time_info.xlsx') %>% dplyr::select(3:24)
View(sensor_time_info)
sensor_time_info <- read_xlsx('../accel_sensor_data/accel_time_info.xlsx') %>% dplyr::select(4:24)
View(sensor_time_info)
start_times <- sensor_time_info %>% dplyr::select(ends_with("start"))
View(start_times)
?strptime
View(sensor_time_info)
start_times <- sensor_time_info %>% dplyr::select(ends_with("start"))
start_times <- sensor_time_info %>% dplyr::select(ends_with("hours"))
View(start_times)
schmoopi<-sensor_time_info[starts_with("hours")]
View(sensor_time_info)
yopi<-colnames(sensor_time_info)[max.col(sensor_time_info,ties.method="first")]
yopi<-colnames(start_times)[max.col(start_times,ties.method="first")]
yopi
View(sensor_time_info)
max.col(hours_durations,ties.method="first")
hours_durations <- sensor_time_info %>% dplyr::select(ends_with("hours"))
max.col(hours_durations,ties.method="first")
sensor_time_info<- read_xlsx('../accel_sensor_data/accel_time_info.xlsx') %>% dplyr::select(4:24)
hours_durations <- sensor_time_info %>% dplyr::select(ends_with("hours"))
max_duration_idx<- max.col(hours_durations,ties.method="first")
max_duration_idx
1:nrow(sensor_time_info)
for (i in 1:nrow(sensor_time_info)) {
print(i)
}
i=1
(max_duration_idx[i]-1)*3+1
start_times <- c()
end_times <- c()
for (i in 1:nrow(sensor_time_info)) {
ref_start_time <- sensor_time_info[i,(max_duration_idx[i]-1)*3+1]
start_times <- c(start_times,ref_start_time)
}
View(tod_motion_features)
View(start_times)
View(start_times)
start_times <- c()
end_times <- c()
for (i in 1:nrow(sensor_time_info)) {
ref_start_time <- sensor_time_info[[i,(max_duration_idx[i]-1)*3+1]]
start_times <- c(start_times,ref_start_time)
}
start_times
start_times <- c()
end_times <- c()
for (i in 1:nrow(sensor_time_info)) {
ref_start_time <- sensor_time_info[[i,(max_duration_idx[i]-1)*3+1]]
ref_end_time <- sensor_time_info[[i,(max_duration_idx[i]-1)*3+2]]
start_times <- c(start_times,ref_start_time)
end_times <- c(end_times,ref_end_time)
}
end_times
View(sensor_time_info)
sensor_time_info<- read_xlsx('../accel_sensor_data/accel_time_info.xlsx') %>% dplyr::select(4:24)
hours_durations <- sensor_time_info %>% dplyr::select(ends_with("hours"))
sensor_start_times <- sensor_time_info %>% dplyr::select(ends_with("start"))
sensor_end_times <- sensor_time_info %>% dplyr::select(ends_with("end"))
max_duration_idx<- max.col(hours_durations,ties.method="first")
start_times <- c()
end_times <- c()
for (i in 1:nrow(sensor_time_info)) {
ref_start_time <- sensor_time_info[[i,(max_duration_idx[i]-1)*3+1]]
ref_end_time <- sensor_time_info[[i,(max_duration_idx[i]-1)*3+2]]
start_times <- c(start_times,ref_start_time)
end_times <- c(end_times,ref_end_time)
}
View(sensor_end_times)
