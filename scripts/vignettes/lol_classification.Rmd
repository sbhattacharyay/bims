---
title: "Classification of Functional Outcoes with Linear Optimal Low Rank Projection (LOL)"
author: "Shubhayu Bhattacharyay, Eshan Joshi, and Matthew Wang"
date: "4/17/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
if (!require(lolR)) install_github('neurodata/lol', build_vignettes=TRUE, force=TRUE)
library(lolR)
library(R.matlab)
library(tidyverse)
library(ggplot2)
library(plotly)
library(naniar)
library(MASS)
library(caret)
source("../functions/generateRootDir.R")
```

## Classification Scheme:
### Predictors:
* Age
* APACHE (for mortality prediction)
* GCS_en (for GOSE prediction)
* Motion Features (3 dimensions)

### Outcomes:
* 1: GOSE at Discharge
* 2: GOSE at 1 year
* 3: Mortality during hospital stay
* 4: Mortality within 1 year

```{r }
draw_auc_plots <- function(list_of_preds){
  for(i in seq_along(list_of_preds)){
      filePath = paste0("../",generateRootDir(paste0(deparse(substitute(list_of_preds)),"/Fold",i,"/")))
      dir.create(filePath, recursive=TRUE,showWarnings = FALSE)
      for(j in seq_along(list_of_preds[[i]])){
          out<-cvAUC(list(na.omit(list_of_preds[[i]][[j]])$bp_pred, 
                          na.omit(list_of_preds[[i]][[j]])$fe_pred,
                          na.omit(list_of_preds[[i]][[j]])$fp_pred,
                          na.omit(list_of_preds[[i]][[j]])$mf_pred,
                          na.omit(list_of_preds[[i]][[j]])$sm_pred,
                          na.omit(list_of_preds[[i]][[j]])$wv_pred),
                     rep(list(na.omit(list_of_preds[[i]][[j]])$ground_truth),6))
          plot_title<-switch(j, 
                         "TOD & GOSE",
                         "TFR & GOSE",
                         "TOD & Favorable GOSE",
                         "TFR & Favorable GOSE",
                         "TOD & Death",
                         "TFR & Death")
          png(paste0(filePath,plot_title,".png"))
          plot(out$perf, col="grey", lty=3)
          plot(out$perf, col="red", avg="vertical", add=TRUE)
          title (paste("5-fold CV AUC:",plot_title))
          dev.off()
      }
    }
}

draw_auc_plots(self_val_predictionsDis)
draw_auc_plots(self_val_predictions12mo)
draw_auc_plots(test_val_predictionsDis)
draw_auc_plots(test_val_predictions12mo)
```