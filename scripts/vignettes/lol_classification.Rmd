---
title: "Classification of Functional Outcoes with Linear Optimal Low Rank Projection (LOL)"
author: "Shubhayu Bhattacharyay, Eshan Joshi, and Matthew Wang"
date: "4/17/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
if (!require(lolR)) install_github('neurodata/lol', build_vignettes=TRUE, force=TRUE)
library(lolR)
library(R.matlab)
library(tidyverse)
library(ggplot2)
library(plotly)
library(naniar)
library(MASS)
library(caret)
source("../functions/generateRootDir.R")
```

## Classification Scheme:
### Predictors:
* Age
* APACHE (for mortality prediction)
* GCS_en (for GOSE prediction)
* Motion Features (3 dimensions)

### Outcomes:
* 1: GOSE at Discharge
* 2: GOSE at 1 year
* 3: Mortality during hospital stay
* 4: Mortality within 1 year


```{r }
get_auc_info <- function(list_of_preds){
  
return (lapply(c(2:7), function(y) {
          lapply(seq_along(list_of_preds[[1]]), function(x) {
            cvAUC(list(na.omit(list_of_preds[[1]][[x]])[[y]],
                       na.omit(list_of_preds[[2]][[x]])[[y]],
                       na.omit(list_of_preds[[3]][[x]])[[y]],
                       na.omit(list_of_preds[[4]][[x]])[[y]],
                       na.omit(list_of_preds[[5]][[x]])[[y]]),
                  list(na.omit(list_of_preds[[1]][[x]])$ground_truth,
                       na.omit(list_of_preds[[2]][[x]])$ground_truth,
                       na.omit(list_of_preds[[3]][[x]])$ground_truth,
                       na.omit(list_of_preds[[4]][[x]])$ground_truth,
                       na.omit(list_of_preds[[5]][[x]])$ground_truth))})
          }))
}

## [[1]]:bp_pred [[2]]:fe_pred [[3]]:fp_pred [[4]]:mf_pred [[5]]:sm_pred [[6]]:wv_pred
val<-names(self_val_predictions12mo[[1]])
get_auc_plots <- function(plot_info){
  filePath = paste0("../",generateRootDir(paste0(deparse(substitute(plot_info)),"/")))
  dir.create(filePath, recursive=TRUE,showWarnings = FALSE)
  color_choice = c('red','blue4','green','purple','pink','cyan2')
  lapply(c(1:6), function(y) {
    png(paste0(filePath,val[y],".png"))
      lapply(seq_along(plot_info), function(x) {
      plot(plot_info[[x]][[y]]$perf, col="grey", lty=3)
      plot(plot_info[[x]][[y]]$perf, avg="vertical",col=color_choice[x], lwd=2, add=TRUE) 
      par(new=TRUE) 
      })
    legend("bottomright", legend=c("bp_pred", "fe_pred","fp_pred", "mf_pred","sm_pred", "wv_pred"),fill=color_choice,cex=0.75)  
    title(val[y])
    dev.off()
  })

}
```

```{r }
self_dis<-get_auc_info(self_val_predictionsDis)
get_auc_plots(self_dis)
self_12mo<-get_auc_info(self_val_predictions12mo)
get_auc_plots(self_12mo)
test_dis<-get_auc_info(test_val_predictionsDis)
get_auc_plots(test_dis)
test_12mo<-get_auc_info(test_val_predictions12mo)
get_auc_plots(test_12mo)
```
   